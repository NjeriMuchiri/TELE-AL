OBJECT CodeUnit 20418 Approval Notification
{
  OBJECT-PROPERTIES
  {
    Date=09/26/23;
    Time=12:33:40 PM;
    Modified=Yes;
    Version List=;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            SendEmailNotification();
          END;

  }
  CODE
  {
    VAR
      SMTPMailSetup@1120054000 : Record 409;
      HREmployees@1120054001 : Record 51516160;
      EmployeeName@1120054002 : Code[20];
      UserSetup@1120054003 : Record 91;
      ApprovalNotificationsetup@1120054004 : Record 51516657;
      SMTPMail@1120054005 : Codeunit 400;
      ApproverEmail@1120054006 : Text;

    PROCEDURE SendEmailNotification@1120054001();
    BEGIN
      SMTPMailSetup.GET;


      ApprovalNotificationsetup.RESET;
      ApprovalNotificationsetup.SETRANGE(ApprovalNotificationsetup."Email Sent",FALSE);
      ApprovalNotificationsetup.SETRANGE(ApprovalNotificationsetup."Notification type",ApprovalNotificationsetup."Notification type"::"Send Approval");
      IF ApprovalNotificationsetup.FINDSET THEN BEGIN
        REPEAT
        EmployeeName:='';
          ApproverEmail:='';
        HREmployees.RESET;
        HREmployees.SETRANGE(HREmployees."User ID",ApprovalNotificationsetup."Approval ID");
        IF HREmployees.FIND('-') THEN BEGIN
          EmployeeName:=HREmployees."First Name"+' '+HREmployees."Last Name";
          ApproverEmail:=HREmployees."Company E-Mail";

          END;
      UserSetup.RESET;
      UserSetup.SETRANGE("User ID",ApprovalNotificationsetup."Approval ID");
      IF UserSetup.FIND('-') THEN BEGIN

      //  hyperlinkText:='http://20.87.212.136:8090';


      SMTPMail.CreateMessage('Approval',SMTPMailSetup."User ID",ApproverEmail,'Approval request','An approval request '+ EmployeeName+ ' document No: '+ApprovalNotificationsetup."Document No"+
      ' has been sent to you for your attention.',TRUE);
      SMTPMail.AppendBody('<br><br>');

      SMTPMail.AppendBody('<br><br>');


      SMTPMail.Send;
      END;
      // EntryNo:=0;
      //
      //  EmailLogs.RESET;
      //  IF EmailLogs.FINDLAST THEN BEGIN
      //   EntryNo:=EmailLogs."Entry No"+1
      //   END ELSE
      //   EntryNo:=EntryNo+1;
      //
      //  EmailLogs.INIT;
      //  EmailLogs."Entry No":=EntryNo+1;
      //  EmailLogs."User Id":=ApprovalNotificationsetup."Approver ID";
      //  EmailLogs."Time Sent":=TIME;
      //  EmailLogs.Date:=TODAY;
      //  //EmailLogs.Link:=hyperlinkText;
      //  EmailLogs."CurrentDate Time":=CURRENTDATETIME;
      //  EmailLogs."Employee Name":=EmployeeName;
      //  EmailLogs."Email Message":='An approval request of document No: '+ApprovalNotificationsetup."Document No"+ ' has been sent to you for your attention.';
      //  EmailLogs.INSERT(TRUE);

      ApprovalNotificationsetup."Email Sent":=TRUE;
      ApprovalNotificationsetup.MODIFY;

      UNTIL ApprovalNotificationsetup.NEXT=0;
       END;
    END;

    BEGIN
    END.
  }
}







































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































